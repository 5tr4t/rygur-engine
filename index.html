<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rygur Engine - Operations Diagnostic</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            padding-top: 80px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .survey-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            padding: 40px;
            margin-bottom: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f3f4;
        }

        .header h1 {
            font-size: 2.4em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            color: #666;
            line-height: 1.5;
            max-width: 600px;
            margin: 0 auto;
        }

        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f1f3f4;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00D1FF 0%, #0099cc 100%);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #00D1FF;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f3f4;
        }

        .question-group {
            margin-bottom: 35px;
            padding: 25px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            background: #fafbfc;
        }

        .question-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        
        .scale-container {
            position: relative;
            margin: 0px 0;
        }

        .scale-row {
          display: grid;
          grid-template-columns: repeat(5, 1fr);
          gap: 0;
          margin-bottom: 15px;
        }

        .scale-cell {
          display: flex;
          flex-direction: column;
          align-items: center;
          height: 100px;
            justify-content: space-between;
        }

        .scale-cell span {
          font-size: 0.9em;
          color: #666;
          text-align: center;
            white-space: normal;
            min-height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1 0 auto;
        }
        
        .radio-option label {
          margin-top: 4px;
        }

        .radio-option {
            position: relative;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            opacity: 0;
            position: absolute;
            width: 0;
            height: 0;
        }

        .radio-option label {
            display: block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: white;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: 500;
            color: #666;
        }

        .radio-option input[type="radio"]:checked + label {
            border-color: #00D1FF;
            background: #00D1FF;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 209, 255, 0.3);
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin-top: 40px;
        }

        .form-section h3 {
            color: #00D1FF;
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            font-size: 1em;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #00D1FF;
            box-shadow: 0 0 0 3px rgba(0, 209, 255, 0.1);
        }

        .submit-section {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f1f3f4;
        }

        .btn-submit {
            background: linear-gradient(135deg, #00D1FF 0%, #0099cc 100%);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 209, 255, 0.3);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 209, 255, 0.4);
        }

        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .scale-labels span {
                font-size: 0.75em;
            }
            
            .container {
                padding: 15px;
            }
            
            .survey-card {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0% Complete</div>
    </div>

    <div class="container">
        <div class="survey-card">
            <div class="header">
                <h1>Rygur Engine - Operations Diagnostic</h1>
                <p>An assessment of your operations' ability to scale.</p>
            </div>

            <form id="surveyForm">
                <div id="survey"></div>

                <!-- Personal Information Section -->
                <div class="form-section">
                    <h3>Personal Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Your Name *</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="business">Business/Organisation Name *</label>
                            <input type="text" id="business" name="business" required>
                        </div>
                        <div class="form-group">
                            <label for="role">Your Role/Title *</label>
                            <input type="text" id="role" name="role" required>
                        </div>
                        <div class="form-group">
                            <label for="industry">Industry Sector *</label>
                            <select id="industry" name="industry" required>
                                <option value="">Select Industry</option>
                                <option value="technology">Technology</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="finance">Financial Services</option>
                                <option value="retail">Retail & E-commerce</option>
                                <option value="manufacturing">Manufacturing</option>
                                <option value="consulting">Consulting</option>
                                <option value="education">Education</option>
                                <option value="government">Government</option>
                                <option value="energy">Energy & Utilities</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="orgSize">Organisation Size *</label>
                            <select id="orgSize" name="orgSize" required>
                                <option value="">Select Size</option>
                                <option value="1-50">1-50 employees</option>
                                <option value="51-200">51-200 employees</option>
                                <option value="201-1000">201-1000 employees</option>
                                <option value="1000+">1000+ employees</option>
                            </select>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="companyCode" name="companyCode" />
                
                <!-- Submit Section -->
                <div class="submit-section">
                    <button type="submit" class="btn-submit" id="submitBtn">
                        Submit Assessment
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
      console.log('Script starting...');
      
      const sections = [
        {
          title: "Section 1: Leadership & Culture",
          questions: [
            "Our leadership team communicates a clear mission, vision, and priorities.",
            "Our employees understand how their work connects to organisational goals.",
            "Our stated values are visible in daily behaviour and decision-making.",
            "Employees feel empowered to make decisions within their scope of responsibility.",
            "We actively invest in learning, development, and leadership capability.",
            "We recognise and reward high performance and collaboration.",
            "Leadership regularly communicates progress, strategy, and challenges transparently.",
            "Our culture encourages feedback, experimentation, and continuous improvement.",
            "Our leadership actively seeks feedback from all levels and acts on it.",
            "The organization prioritizes diversity, equity, and inclusion at leadership and team levels.",
            "Psychological safety is visibly promoted, enabling employees to speak up without fear of negative consequences."
          ]
        },
        {
          title: "Section 2: Performance & Governance",
          questions: [
            "We have clear KPIs aligned with business outcomes and customer value.",
            "Responsibilities for each KPI are clearly assigned and monitored.",
            "Performance data is accurate, timely, and easily accessible.",
            "Leaders regularly review performance data and act on it.",
            "Key decisions are supported by data rather than intuition alone.",
            "Issues and risks are escalated quickly and resolved effectively.",
            "Our management information and dashboards are automated where possible.",
            "We regularly refine or retire KPIs that no longer drive performance.",
            "Strategic and operational goals are regularly aligned and revisited with cross-functional input.",
            "There are clear escalation paths for unresolved issues that may affect organizational objectives.",
            "Continuous feedback loops connect performance outcomes with process improvements."
          ]
        },
        {
          title: "Section 3: Structure, Roles & Responsibilities",
          questions: [
            "Roles and responsibilities are clearly defined and understood across teams.",
            "Decision rights are well-articulated, reducing ambiguity and delay.",
            "We have the right balance of skills and experience to deliver business goals.",
            "There are no critical single points of dependency in key roles or processes.",
            "Succession planning exists for all key positions.",
            "Resource capacity is regularly reviewed and adjusted as we grow.",
            "Cross-functional teams work effectively together with clear ownership.",
            "We proactively plan for future skill needs (e.g., digital, data, customer).",
            "Cross-team collaboration is incentivized and measured.",
            "All employees have clear, documented development and career pathways.",
            "Accountability for outcomes (not just tasks) is embedded at all levels."
          ]
        },
        {
          title: "Section 4: Process Discipline",
          questions: [
            "Our key business and regulatory processes are clearly mapped and documented.",
            "Everyone understands the activities needed to achieve customer and business outcomes.",
            "Processes are standardised across teams where appropriate.",
            "Process documentation (SOPs, maps) is reviewed and updated regularly.",
            "We use automation or workflow tools to reduce manual effort and risk.",
            "There is a clear owner for continuous process improvement.",
            "Our processes deliver consistent, repeatable results.",
            "Feedback from customers or staff leads to tangible process improvements.",
            "Change management processes are standardized for all major operational changes.",
            "There is regular training on process adherence and improvements.",
            "A central repository of living process documentation is actively maintained and referenced by teams."
          ]
        },
        {
          title: "Section 5: Technology & Enablement",
          questions: [
            "We have the right tools and systems to support our most critical processes.",
            "Our technology stack scales effectively with projected business growth.",
            "Data flows seamlessly between systems (limited duplication or manual re-entry).",
            "We actively manage and modernise our technology roadmap.",
            "Automation is used to eliminate manual or repetitive work where possible.",
            "We have visibility of key performance data across systems in real time.",
            "There is clear ownership of technology decisions and priorities.",
            "Technology investments are guided by measurable business outcomes.",
            "Cybersecurity and data privacy controls are embedded in technology processes.",
            "Technology adoption is supported by tailored learning and support for users.",
            "Technology investments are routinely evaluated for their alignment with business and customer value."
          ]
        },
        {
          title: "Section 6: Risk & Resilience",
          questions: [
            "We proactively identify and assess key operational and strategic risks.",
            "Risk owners are clearly defined and accountable.",
            "We regularly review and discuss top risks and mitigations.",
            "Our controls are tested regularly to ensure they're effective.",
            "We have a clear incident management process and escalation path.",
            "Lessons from incidents or near-misses are documented and acted upon.",
            "Our business continuity and resilience plans are up to date and tested.",
            "Risk considerations are embedded in decision-making, not treated as a separate activity.",
            "Emerging risks (regulatory, geopolitical, industry-specific) are systematically scanned and assessed.",
            "Incident response simulations or tabletop exercises are conducted regularly.",
            "Key risk indicators (KRIs) are tracked and influence decision-making in real time."
          ]
        } 
      ];

      const options = [
        "Strongly Disagree",
        "Disagree",
        "Neither Agree or Disagree",
        "Agree",
        "Strongly Agree"
      ];

      // Generate survey HTML
      let html = '';
      let qCount = 1;
      sections.forEach((section, sIdx) => {
        html += `<div class="section">
            <h2 class="section-title">${section.title}</h2>`;
        section.questions.forEach((q, qIdx) => {
          html += `<div class="question-group">
            <div class="question-title">${qCount}. ${q}</div>
            <div class="scale-row">`;
          options.forEach((option, oIdx) => {
            html += `<div class="scale-cell">
              <span>${option}</span>
              <div class="radio-option">
                <input type="radio" name="q${qCount}" value="${oIdx+1}" id="q${qCount}_${oIdx+1}" ${oIdx===0?'required':''}>
                <label for="q${qCount}_${oIdx+1}">${oIdx+1}</label>
              </div>
            </div>`;
          });
          html += `</div></div>`;
          qCount++;
        });
        html += `</div>`;
      });
      document.getElementById('survey').innerHTML = html;
      console.log('Survey HTML generated');
    </script>
    
    <script>
      window.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, checking for companyCode...');
        const params = new URLSearchParams(window.location.search);
        const code = params.get('companyCode');
        if (code) {
          document.getElementById('companyCode').value = code;
          console.log('Company code set:', code);
        }
      });
    </script>
    
    <script>
        console.log('Progress tracking script starting...');
        
        // Progress tracking
        const totalQuestions = 66;
        const totalFields = 6;
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        function updateProgress() {
            let completedQuestions = 0;
            for (let i = 1; i <= totalQuestions; i++) {
                const questionInputs = document.querySelectorAll(`input[name="q${i}"]`);
                const isAnswered = Array.from(questionInputs).some(input => input.checked);
                if (isAnswered) completedQuestions++;
            }
            
            let completedFields = 0;
            const personalFields = ['name', 'email', 'business', 'role', 'industry', 'orgSize'];
            personalFields.forEach(field => {
                const input = document.getElementById(field);
                if (input && input.value.trim()) completedFields++;
            });
            
            const totalItems = totalQuestions + totalFields;
            const completedItems = completedQuestions + completedFields;
            const percentage = Math.round((completedItems / totalItems) * 100);
            
            progressFill.style.width = percentage + '%';
            progressText.textContent = percentage + '% Complete';
            
            const submitBtn = document.getElementById('submitBtn');
            if (percentage === 100) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;  // change to true for production
            }
        }
        
        document.addEventListener('change', updateProgress);
        document.addEventListener('input', updateProgress);
        
        // Form submission with improved error handling
        document.getElementById('surveyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Form submit triggered!');
            
            const formData = new FormData(this);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            console.log('Submitting Survey Data:', data);
            console.log('Total fields collected:', Object.keys(data).length);
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            fetch('https://str4t.app.n8n.cloud/webhook-test/5e507fd0-4e9d-42ff-906f-dd2343d574f0', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                console.log('Response received!');
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text().then(text => {
                    console.log('Response text:', text);
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        return { message: text || 'Success' };
                    }
                });
            })
            .then(result => {
                console.log('Success:', result);
                alert('Thank you! Your Operations Diagnostic input has been submitted successfully.');
                submitBtn.textContent = 'Submitted!';
            })
            .catch(error => {
                console.error('Error occurred:', error);
                alert('There was an error submitting your response. Please try again or contact support.\n\nError: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Assessment';
            });
        });
        
        console.log('Event listeners attached');
        updateProgress();
    </script>
</body>
</html>
